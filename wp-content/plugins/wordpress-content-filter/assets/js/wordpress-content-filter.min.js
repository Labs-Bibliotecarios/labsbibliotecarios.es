!function($){"use strict";function WCF_Form(element,options){this.$el=$(element),this.options=$.extend({scroll_top:"yes",tooltip:"yes",ajax_loader:'<div class="wcf-ajax-loading"></div>',ajax_complete:"",ajax_url:"yes",clear_class:"",clear_icon:"&times;"},options),this.init()}WCF_Form.prototype={init:function(){this.toggle_field(),this.form_search()},toggle_field:function(){$(".wcf-arrow-field .wcf-label").on("click",function(e){e.preventDefault();var $this=$(this);$this.parent().find(".wcf-field-body").slideToggle(300,function(){$this.toggleClass("wcf-closed")})})},init_date:function(form){$(".range_date_wrapper",form).each(function(){var $this=$(this),format_date=$this.data("format-date"),dateFrom=$(".date_from",$this),dateTo=$(".date_to",$this);0<dateFrom.length&&(dateFrom.datepicker({defaultDate:"+1w",changeMonth:!1,showOtherMonths:!0,dateFormat:format_date,onClose:function(selectDate){dateTo.datepicker("option","minDate",selectDate)},showOn:"button",buttonText:'<span class="dashicons dashicons-calendar-alt"></span>',beforeShow:function(el,ob){ob.dpDiv.addClass("wcf-date-picker-skin")}}),dateTo.datepicker({defaultDate:"+1w",changeMonth:!1,showOtherMonths:!0,dateFormat:format_date,onClose:function(selectDate){dateFrom.datepicker("option","maxDate",selectDate)},showOn:"button",buttonText:'<span class="dashicons dashicons-calendar-alt"></span>'}))})},init_range_slider:function(form,auto_filter){var _this=this,slider_range=$(".slider-range",form);0<slider_range.length&&slider_range.each(function(){var $this=$(this),currentMax=$this.parent(),step=$this.data("step"),emin=$(".range_min",currentMax),emax=$(".range_max",currentMax),spanFrom=$("span.range_from",currentMax.parent()),spanTo=$("span.range_to",currentMax.parent()),min=emin.data("min"),max=emax.data("max"),currentMin=parseInt(emin.val()),currentMax=parseInt(emax.val());$this.slider({range:!0,step:step,min:min,max:max,values:[currentMin,currentMax],slide:function(event,ui){spanFrom.html(ui.values[0]),spanTo.html(ui.values[1])},stop:function(event,ui){emin.val(ui.values[0]),emax.val(ui.values[1]),_this.form_submit(form,auto_filter)},change:function(event,ui){}})})},init_checkbox:function(form,auto_filter){var _this=this;$(".wcf-checkbox-all",form).on("click",function(e){var $this=$(this),parent=$this.closest(".wcf-field-checkbox");$this.is(":checked")?parent.find(".wcf-checkbox-item").prop("checked",!0):parent.find(".wcf-checkbox-item").prop("checked",!1),_this.form_submit(form,auto_filter)}),$(".wcf-field-checkbox, .wcf-field-taxonomy_checkbox, .wcf-field-checkbox_color",form).each(function(){var parent=$(this),all_item=$(".wcf-checkbox-all",parent),item=$(".wcf-checkbox-item",parent),count_item=item.length;all_item.on("click",function(e){$(this).is(":checked")?item.prop("checked",!0):item.prop("checked",!1),_this.form_submit(form,auto_filter)}),item.on("click",function(){parent.find(".wcf-checkbox-item:checked").length==count_item?all_item.prop("checked",!0):all_item.prop("checked",!1),_this.form_submit(form,auto_filter)})})},reset:function(form,auto_filter){var _this=this;form.find(".wcf-reset-button").on("click",function(){form.find("[data-reset]").each(function(){var min,max,min_val,display_type,arr_reset,$this=$(this),type=$this.data("type"),reset=$this.data("reset");"rating"==type?($this.find("input").attr("checked",!1),$this.find('input[value="'+reset+'"]').attr("checked",!0)):"range_slider"==type||"price"==type?(min=$this.find(".range_min"),max=$this.find(".range_max"),min_val=parseInt(min.data("min")),arr_reset=parseInt(max.data("max")),$this.find(".slider-range").slider("option","values",[min_val,arr_reset]),min.val(min_val),max.val(arr_reset),$this.find(".range_from").text(min_val),$this.find(".range_to").text(arr_reset)):"taxonomy"==type||"meta_field"==type||"acf"==type?"checkbox"==(display_type=$this.data("display"))||"color"==display_type||"multiselect"==display_type?(arr_reset=reset.split("|"),$this.find("option").attr("selected",!1),$this.find('input[type="checkbox"]').attr("checked",!1),$.each(arr_reset,function(index,value){"multiselect"==display_type?$this.find('option[value="'+value+'"]').attr("selected",!0):$this.find('input[value="'+value+'"]').attr("checked",!0)})):"radio"==display_type?$this.find('input[value="'+reset+'"]').attr("checked",!0):"select"==display_type?$this.find("select").val(reset):"text"==display_type?$this.find('input[type="text"]').val(reset):"textarea"==display_type&&$this.find('input[type="textarea"]').val(reset):"date"==type?$this.find('input[type="text"]').val(reset):"author"==type||"sort"==type?$this.find("select").val(reset):"input_query"==type&&$this.val(reset)}),_this.form_submit(form,auto_filter)})},form_search:function(){var _this=this,$form=this.$el,form_id=$form.data("form"),result_layout=$("#wcf-form-wrapper-"+form_id),result_layout_length=result_layout.length,auto=$form.data("auto"),pathname=window.location.pathname,enable_ajax=$form.data("ajax"),template_loop=result_layout.data("loop"),columns=result_layout.data("columns"),gridtype=result_layout.data("gridtype");result_layout_length&&"ajax"==enable_ajax&&_this.pagination_link(result_layout,form_id,template_loop,columns,gridtype,""),"yes"==auto&&$('input[type="text"], input[type="radio"], select, textarea',$form).on("change",function(){$form.submit()}),$form.on("submit",function(form_data){0==result_layout_length||("ajax"==enable_ajax?(form_data.preventDefault(),form_data=$form.serialize(),"yes"==_this.options.ajax_url&&window.history.pushState("",document.title,pathname+"?"+form_data),result_layout.append(_this.options.ajax_loader),"yes"==_this.options.scroll_top&&_this.scroll_top(result_layout),$.post(wcf_variables.ajax_url,{action:"wcf_search_ajax",wcf_ajax_nonce:wcf_variables.wcf_ajax_nonce,pathname:pathname,search:form_data,form_id:form_id,loop:template_loop,result_columns:columns,gridtype:gridtype,sort_result:""},function(response){_this.response_callback(response,result_layout,form_id,template_loop,columns,gridtype,"")})):$form.attr("action",""))}),_this.init_date($form),_this.init_checkbox($form,auto),_this.init_range_slider($form,auto),_this.reset($form,auto),_this.clear_query($form),_this.tooltip($form),_this.toggle_searchform($form),_this.ini_sorttable(result_layout),_this.results_sort(result_layout,form_id,template_loop,columns,gridtype),_this.init_masonry(result_layout,columns)},toggle_searchform:function(form){form.parent().find(".wcf-toggle-searchform").on("click",function(e){e.preventDefault();$(this);$(".wcf-off-menu-push").toggleClass("wcf-off-menu-push-right"),$(".wcf-off-menu").toggleClass("wcf-off-menu-open")}),form.find(".wcf-off-menu-toggle").on("click",function(e){e.preventDefault();$(this);$(".wcf-off-menu-push").toggleClass("wcf-off-menu-push-right"),$(".wcf-off-menu").toggleClass("wcf-off-menu-open")})},tooltip:function(form){"yes"==this.options.tooltip?form.find("[data-tooltip]").each(function(){var $this=$(this),intro=$this.data("tooltip");$this.removeAttr("data-tooltip"),""!=intro&&$this.wrapInner('<span data-tooltip="'+intro+'"></span>')}):form.find("[data-tooltip]").removeAttr("data-tooltip")},clear_query:function(form){var clear_button,$this=form.find('input[name="s"]');function show_button(){0<$this.val().replace(/^\s+|\s+$/g,"").length?clear_button.show():clear_button.hide(),clear_button.css({top:$this.outerHeight()/2-clear_button.height()/2})}0!=$this.length&&($this.parent().hasClass("wcf-clear-query-wrapper")||($this.wrap('<div class="wcf-clear-query-wrapper"></div>'),$this.after('<a class="wcf-clear-query '+this.options.clear_class+'">'+this.options.clear_icon+"</a>")),(clear_button=$this.next()).on("click",function(e){e.preventDefault(),$this.val(""),show_button(),$this.focus()}),$this.on("keyup keydown change focus",show_button),show_button())},ajax_call:function(wrapper,form_id,template_loop,columns){wrapper.trigger("wcf_form_search_ajax_done",[wrapper,form_id,template_loop,columns])},form_submit:function(form,auto_filter){"yes"==auto_filter&&form.submit()},results_sort:function(wrapper,form_id,template_loop,columns,gridtype){var sort_value,_this=this;$("#wcf-results-sort",wrapper).unbind().on("change",function(e){sort_value=$(this).val();var page_number=$(this).data("page"),pathname=$(this).closest("form").attr("action"),search=document.createElement("a");search.href=pathname,"yes"==_this.options.ajax_url&&window.history.pushState("",document.title,search.pathname+search.search),wrapper.append(_this.options.ajax_loader);pathname=search.pathname,search=search.search;""!=search&&"?"==search.substring(0,1)&&(search=search.replace("?","")),"yes"==_this.options.scroll_top&&_this.scroll_top(wrapper),$.post(wcf_variables.ajax_url,{action:"wcf_search_ajax",wcf_ajax_nonce:wcf_variables.wcf_ajax_nonce,pathname:pathname,search:search,page_number:page_number,form_id:form_id,loop:template_loop,result_columns:columns,gridtype:gridtype,sort_result:sort_value},function(response){_this.response_callback(response,wrapper,form_id,template_loop,columns,gridtype,sort_value)})})},response_callback:function(response,wrapper,form_id,template_loop,columns,gridtype,sort_value){var _this=this;wrapper.animate({opacity:0},0,function(){wrapper.html(response),_this.init_masonry(wrapper,columns),wrapper.animate({opacity:1},300,function(){_this.pagination_link(wrapper,form_id,template_loop,columns,gridtype,sort_value),_this.results_sort(wrapper,form_id,template_loop,columns,gridtype),_this.ini_sorttable(wrapper),_this.ajax_call(wrapper,form_id,template_loop,columns,gridtype),$.isFunction(_this.options.ajax_complete)&&_this.options.ajax_complete.call(_this)})})},init_masonry:function(result_layout,column){"yes"==result_layout.data("masonry")&&$.fn.masonry&&result_layout.find(".wcf-items-results").masonry({itemSelector:".wcf-column-"+column})},pagination_link:function(wrapper,form_id,template_loop,columns,gridtype,sort_value){var _this=this;$(".wcf-pagination a",wrapper).unbind().on("click",function(search){search.preventDefault();var page_number=$(this).data("page"),pathname=$(this).attr("href"),search=document.createElement("a");search.href=pathname,"yes"==_this.options.ajax_url&&window.history.pushState("",document.title,search.pathname+search.search),wrapper.append(_this.options.ajax_loader);pathname=window.location.pathname,search=window.location.search;""!=search&&"?"==search.substring(0,1)&&(search=search.replace("?","")),"yes"==_this.options.scroll_top&&_this.scroll_top(wrapper),$.post(wcf_variables.ajax_url,{action:"wcf_search_ajax",wcf_ajax_nonce:wcf_variables.wcf_ajax_nonce,pathname:pathname,search:search,page_number:page_number,form_id:form_id,loop:template_loop,result_columns:columns,gridtype:gridtype,sort_result:sort_value},function(response){_this.response_callback(response,wrapper,form_id,template_loop,columns,gridtype,sort_value)})})},scroll_top:function(result_layout){$("html, body").animate({scrollTop:result_layout.offset().top-100},200)},ini_sorttable:function(wrapper){$("#wcf-table-pager",wrapper).empty(),$(".wcftablesorter",wrapper).wcftablesorter(),$(".wcftablepager",wrapper).wcftablepager()}};$.fn.wcftablepager=function(){return this.each(function(){var $pager,count,pagesize,numpages,page,containerid,table=this,tbody=table.tBodies[0];function rows(){return $(tbody).find("tr:not(.wcftablepager-initiallyhidden)")}function set_visibility(){var $rows=rows(),min=(page-1)*pagesize,max=page*pagesize;$rows.each(function(idx){min<=idx&&idx<max?$(this).removeClass("wcftablepager-hide"):$(this).addClass("wcftablepager-hide")})}function set_page(newpage){numpages<(page=(page=newpage)<1?1:page)&&(page=numpages),$pager.find(".wcftablepager-display").val(page+"/"+numpages),set_visibility()}function set_elements(){count=rows().length,numpages=Math.ceil(count/pagesize)||1,set_page(page)}function set_pagesize(newpagesize){var currpos=((page||1)-1)*(pagesize||1);pagesize=newpagesize,numpages=Math.ceil(count/pagesize)||1,set_page(Math.floor(currpos/pagesize)+1)}containerid=$(table).attr("data-pager-template-id")||"",$pager=$(""!=containerid?$("#"+containerid).html():'<div class="wcftablepager-pager"><button type="button" class="wcftablepager-first"></button><button type="button" class="wcftablepager-prev"></button><input type="text" class="wcftablepager-display" readonly><button type="button" class="wcftablepager-next"></button><button type="button" class="wcftablepager-last"></button><select class="wcftablepager-pagesize"><option selected value="10">×10</option><option value="20">×20</option><option value="50">×50</option><option value="999999">All</option></select></div>'),""!=(containerid=$(table).attr("data-pager-id")||"")?$pager.appendTo($("#"+containerid)):$pager.insertBefore(table),$pager.find(".wcftablepager-first").on("click",function(){set_page(1)}),$pager.find(".wcftablepager-prev").on("click",function(){set_page(page-1)}),$pager.find(".wcftablepager-next").on("click",function(){set_page(page+1)}),$pager.find(".wcftablepager-last").on("click",function(){set_page(numpages)}),$pager.find(".wcftablepager-pagesize").on("change",function(){set_pagesize(+this.value||10)}),$(table).on("wcftablesorter-sorted",set_visibility),$(table).on("wcftablepager-elements",set_elements),$(tbody).find("tr:not(:visible)").addClass("wcftablepager-initiallyhidden"),count=rows().length,set_pagesize(+$pager.find(".wcftablepager-pagesize").val()||10)})},$.fn.wcftablesorter=function(){return this.each(function(){var columnidx,table=this;function sort(columnidx,colspan,descending){function cmp(num1,res){var str1=num1.text,str2=res.text;if(""==str1)return 1;if(""==str2)return-1;num1=+str1,res=+str2,res=isNaN(num1)||isNaN(res)?str1.localeCompare(str2):num1-res;return descending?-res:res}$.each(table.tBodies,function(){var $tbody=$(this),rows=$.map($tbody.find("tr"),function(tr){return{tr:tr,text:function(row){for(var text="",i=columnidx;i<columnidx+colspan;++i){var cell=row.cells[i];cell&&(text+=cell.textContent)}return text.trim()}(tr)}});rows.sort(cmp);rows=$.map(rows,function(rowtext){return rowtext.tr});$(rows).appendTo($tbody)})}columnidx=0,$.each(table.tHead.rows[0].cells,function(){var $th=$(this),colspan=+$th.attr("colspan")||1;"false"!=$th.attr("data-wcftablesorter")&&($th.attr("tabindex",0),$th.addClass("wcftablesorter-header wcftablesorter-unsorted"),$th.on("click",function(columnidx,colspan){var $th=$(this),descending=$th.hasClass("wcftablesorter-asc");$th.siblings(".wcftablesorter-header").removeClass("wcftablesorter-asc wcftablesorter-desc").addClass("wcftablesorter-unsorted"),$th.removeClass("wcftablesorter-unsorted wcftablesorter-asc wcftablesorter-desc").addClass(descending?"wcftablesorter-desc":"wcftablesorter-asc"),$th.addClass("wcftablesorter-sorting"),setTimeout(function(){sort(columnidx,colspan,descending),$th.removeClass("wcftablesorter-sorting"),$(table).trigger("wcftablesorter-sorted")},50)}.bind(this,columnidx,colspan))),columnidx+=colspan}),$(table.tBodies).attr("aria-live","polite")})},$.fn.WCFilter=function(options){return this.each(function(){$.data(this,"plugin_wcfilter")||$.data(this,"plugin_wcfilter",new WCF_Form(this,options))})}}(jQuery);
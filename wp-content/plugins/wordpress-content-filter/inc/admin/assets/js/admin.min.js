!function($){"use strict";$(document).ready(function(){var WCF_Admin={init_events_load:!1,init:function(){this.build_sortable_draggable(),this.init_element_media(),this.init_color(),this.init_events(),this.init_settings_events()},build_sortable_draggable:function(){$("#wcf-forms-search-fields-list").sortable({handle:".menu-item-handle",revert:!0,placeholder:"sortable-placeholder",start:function(e,ui){ui.helper.width("100%"),ui.helper.height("auto"),ui.placeholder.width("100%"),ui.placeholder.height(ui.helper.outerHeight())},stop:function(e,field_type){var menu_item_settings,item=field_type.item;item.hasClass("ui-draggable")&&(item.addClass("wcf-loading"),item.removeClass("ui-draggable"),item.removeClass("wcf-icon-menu"),field_type=item.data("type"),menu_item_settings=$(".menu-item-settings",item),$.post(ajaxurl,{field_type:field_type,action:"wcf_field_settings_output",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(response){item.removeClass("wcf-loading"),menu_item_settings.prepend(response);menu_item_settings.find(".wcf-field-id").val();menu_item_settings.slideDown("fast",function(){item.find(".wcf-item-edit").addClass("open")}),WCF_Admin.init_item_events(item,menu_item_settings)}))}}),$("#wcf-forms-available-field-list > li").draggable({connectToSortable:"#wcf-forms-search-fields-list",helper:"clone",revert:"invalid",zIndex:100,start:function(event,type){type=type.helper.data("type");return"input_query"==type&&WCF_Admin.check_item(type)?(alert(wcf_forms_variables.input_query_exist),!1):"submit_button"==type&&WCF_Admin.check_item(type)?(alert(wcf_forms_variables.submit_button_exist),!1):"rating"==type&&WCF_Admin.check_item(type)?(alert(wcf_forms_variables.rating_exist),!1):void 0}})},init_events:function(){$("#wcf-forms-search-fields-list li").each(function(){var $this=$(this),menu_item_settings=$(".menu-item-settings",$this);WCF_Admin.init_item_events($this,menu_item_settings)}),this.init_events_load=!0},init_settings_events:function(){var post_type_checkbox=$(".wcf_post_type_checkbox").first(),checkbox=post_type_checkbox.find('input[type="checkbox"]');$('input[name="wcf-settings[search_type]"]').on("change",function(){"single"==$(this).val()&&(checkbox.prop("checked",!1),checkbox.first().prop("checked",!0))}),checkbox.on("click",function(){var search_type=$('input[name="wcf-settings[search_type]"]:checked'),count=post_type_checkbox.find('input[type="checkbox"]:checked').length;if("single"==search_type.val())checkbox.prop("checked",!1),$(this).prop("checked",!0);else if(count<1)return alert(wcf_forms_variables.at_least_one_post_type),!1})},init_item_events:function(parent,menu_item_settings){var display_type,default_value,exclude_terms,taxonomy,terms_color,_this=this,field_id=menu_item_settings.find(".wcf-field-id").val(),field_type=parent.data("type"),thickbox_body=$("#wcf-thickbox-body");menu_item_settings.find(".wcf-delete-field").on("click",function(e){e.preventDefault(),WCF_Admin.remove_field($(this))}),menu_item_settings.find(".wcf-cancel-field").on("click",function(e){e.preventDefault(),menu_item_settings.slideUp("fast",function(){parent.find(".wcf-item-edit").removeClass("open")})}),parent.find(".wcf-item-edit").unbind().on("click",function(e){e.preventDefault();var $_this=$(this);menu_item_settings.slideToggle("fast",function(){$_this.toggleClass("open")})}),"meta_field"==field_type?$("#wcf_forms_field_meta_key_"+field_id).on("change",function(){$.post(ajaxurl,{meta_key:$(this).val(),field_id:field_id,field_type:field_type,action:"wcf_generate_meta_key_options",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(response){$("#wcf_forms_field_options_"+field_id).val(response)})}):"taxonomy"==field_type&&(display_type=parent.find("#wcf_forms_field_display_type_"+field_id),default_value=parent.find("#wcf_forms_field_default_value_"+field_id),exclude_terms=parent.find("#wcf_forms_field_exclude_terms_"+field_id),taxonomy=parent.find("#wcf_forms_field_taxonomy_"+field_id),terms_color=$("#forms_field_wcf_forms_field_terms_color_"+field_id),taxonomy.on("change",function(){$.post(ajaxurl,{taxonomy:$(this).val(),field_id:field_id,field_type:field_type,field_name:"wcf_forms_field_terms_color_"+field_id,action:"wcf_terms_color",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(response){terms_color.find(".wcf-form-field-wrapper, table").remove(),terms_color.find(".wcf-field-label").after(response),_this.init_color(terms_color)})}),terms_color.find(".wcf-generate-terms-color-button").on("click",function(e){e.preventDefault(),taxonomy.trigger("change")}),display_type.on("change",function(e){"color"==$(this).val()?terms_color.show():terms_color.hide()}),_this.init_events_load||display_type.trigger("change"),parent.on("click",".wcf-select-terms-button",function(e){e.preventDefault(),thickbox_body.html("Loading ...");var is_single,select_type=$(this).data("type");""==taxonomy.val()?thickbox_body.html(wcf_forms_variables.please_select_taxonomy):(is_single=!1,"select"!=display_type.val()&&"radio"!=display_type.val()||(is_single=!0),$.post(ajaxurl,{field_id:field_id,field_type:field_type,select_type:select_type,is_single:is_single,taxonomy:taxonomy.val(),action:"wcf_select_terms",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(response){thickbox_body.html(response),$(".insert_term",thickbox_body.parent()).unbind().on("click",function(taxonomy_value){taxonomy_value.preventDefault();taxonomy_value=thickbox_body.find("#wcf-taxonomy-select").val();0<taxonomy_value.length&&("default"==select_type?(0==is_single&&(taxonomy_value=taxonomy_value.join("\n")),default_value.val(taxonomy_value)):"exclude"==select_type&&(taxonomy_value=taxonomy_value.join(","),exclude_terms.val(taxonomy_value))),tb_remove()})}))}))},init_color:function(ob){var color_picker=$(".wcf-color-picker");(color_picker=null!=ob?$(".wcf-color-picker",ob):color_picker).each(function(){$(this).wpColorPicker()})},init_element_media:function(){var _this=this;$(".wcf-upload-image").on("click",function(field_key){field_key.preventDefault();var $this=$(this),field_key=$this.attr("data-field");_this.upload_media(field_key,$this.parent())})},upload_media:function(field_key,ob){var media=wp.media({title:"Insert a media",library:{type:"image"},multiple:!1,button:{text:"Insert"}});return media.on("select",function(){var first=media.state().get("selection").first().toJSON();$("#"+field_key,ob).val(first.url)}),media.open(),!1},remove_field:function(el){var parent=el.closest(".wcf_forms_field_li");parent.animate({opacity:0,height:0},350,function(){parent.remove()})},check_item:function(field_type){return!!$('#wcf-forms-search-fields-list li[data-type="'+field_type+'"]').length}};WCF_Admin.init()})}(jQuery);